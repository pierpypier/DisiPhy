<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Tessere Interattive</title>
  <style>
    body {
      margin: 0;
      overflow: hidden;
      background: url('tessere/sfondor.jpg') no-repeat center center fixed;
      background-size: cover;
      font-family: sans-serif;
    }
    /* Pulsanti di navigazione */
    .nav-buttons {
      position: fixed;
      top: 20px;
      left: 20px;
      z-index: 1000;
    }
    .nav-buttons button {
      margin-right: 5px;
      padding: 5px 10px;
      border: none;
      background: #007BFF;
      color: #fff;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
    }
    .nav-buttons button:hover {
      background: #0056b3;
    }
    /* Tessera draggable */
    .draggable {
      position: absolute;
      cursor: grab;
      touch-action: none;
      width: 120px;
      text-align: center;
    }
    .draggable:active { cursor: grabbing; }
    .draggable img {
      width: 100%;
      border-radius: 8px;
      border: 0px solid #ccc;
      pointer-events: none;
      user-select: none;
    }
    /* Caption auto-resize */
    .caption {
      margin-top: 5px;
    }
    .caption textarea {
      width: 100%;
      box-sizing: border-box;
      padding: 4px;
      border-radius: 4px;
      border: 1px solid #ccc;
      resize: none;
      overflow: hidden;
      font-size: 14px;
      font-family: inherit;
    }
  </style>
</head>
<body>

  <!-- Bottoni di navigazione -->
  <div class="nav-buttons">
    <button onclick="location.href='tessere3.html'">Tessere 3</button>
    <button onclick="location.href='tessere4.html'">Tessere 4</button>
  </div>

  <!-- Tessera 001 -->
  <div class="draggable" id="tile001" data-id="001" style="top:50px; left:50px;">
    <img src="tessere/001.gif" draggable="false" alt="001">
    <div class="caption">
      <textarea placeholder=""></textarea>
    </div>
  </div>

  <!-- Tessera 002 -->
  <div class="draggable" id="tile002" data-id="002" style="top:200px; left:50px;">
    <img src="tessere/002.gif" draggable="false" alt="002">
    <div class="caption">
      <textarea placeholder=""></textarea>
    </div>
  </div>

  <!-- Tessera 003 -->
  <div class="draggable" id="tile003" data-id="003" style="top:350px; left:50px;">
    <img src="tessere/003.gif" draggable="false" alt="003">
    <div class="caption">
      <textarea placeholder=""></textarea>
    </div>
  </div>

  <script>
    // Auto-resize del textarea
    function autoResizeTextarea(el) {
      el.style.height = 'auto';
      el.style.height = el.scrollHeight + 'px';
    }

    window.onload = function() {
      document.querySelectorAll(".draggable").forEach(el => {
        const id = el.dataset.id;
        const ta = el.querySelector("textarea");

        // Ripristina posizione
        const x = localStorage.getItem("posX_" + id);
        const y = localStorage.getItem("posY_" + id);
        if (x !== null && y !== null) {
          el.style.left = x + "px";
          el.style.top  = y + "px";
        }

        // Ripristina testo
        const txt = localStorage.getItem("text_" + id);
        if (txt !== null) {
          ta.value = txt;
          autoResizeTextarea(ta);
        }

        // Salva testo al volo
        ta.addEventListener("input", () => {
          localStorage.setItem("text_" + id, ta.value);
          autoResizeTextarea(ta);
        });

        // Drag&drop con Pointer Events
        let dragging=false, offsetX=0, offsetY=0;
        el.addEventListener("pointerdown", e => {
          dragging = true;
          offsetX = e.clientX - el.offsetLeft;
          offsetY = e.clientY - el.offsetTop;
          el.setPointerCapture(e.pointerId);
        });
        el.addEventListener("pointermove", e => {
          if (!dragging) return;
          el.style.left = (e.clientX - offsetX) + "px";
          el.style.top  = (e.clientY - offsetY) + "px";
        });
        el.addEventListener("pointerup", e => {
          if (!dragging) return;
          dragging = false;
          el.releasePointerCapture(e.pointerId);
          localStorage.setItem("posX_" + id, parseInt(el.style.left));
          localStorage.setItem("posY_" + id, parseInt(el.style.top));
        });
        el.addEventListener("pointercancel", e => {
          dragging = false;
          el.releasePointerCapture(e.pointerId);
        });
      });
    };
  </script>
</body>
</html>
